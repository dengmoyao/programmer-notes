## Redis 基础

### Redis 特性

Redis是一个高性能的key-value存储系统，具有如下的特性：

+ __速度快__： 数据在内存中，C语言编写，单线程
+ __支持丰富的数据类型__：value支持string，list，set，sorted set，hash等
+ __支持持久化__： redis所有的数据保存在内存中，对数据的更新将异步地保存到磁盘上，可选RDB/AOF
+ __功能丰富__：发布订阅，lua脚本，事务，pipeline等

### Redis 数据类型

#### 字符串 (Strings)

字符串是一种最基本的Redis值类型，

+ 二进制安全，可以包含任意任意类型的数据，例如：一张JPEG的图片，或者一个序列化的对象
+ 最多能存储512M字节的内容
+ 利用INCR命令簇(INCR,DECR,INCRBY) 来把字符串当作原子计数器使用
+ 利用APPEND命令在字符串后面添加内容
+ 将字符串作为GETRANGE 和 SETRANGE的随机访问向量

#### 列表 (Lists)

Redis 列表是简单的字符串列表，

+ 按照插入顺序排序
+ 一个列表最多可以包含2^32 - 1个元素
+ 双向无环链表实现，在两端插入速度很快

#### 集合 (Sets)

Redis 集合是一个无序的字符串合集，

+ 无重复元素
+ O(1)的时间复杂度完成添加删除操作
+ 一个集合最多可以包含2^32 - 1个元素
+ 支持求交集和并集等操作

#### 哈希 (Hashes)

Redis Hashes是字符串字段和字符串值之间的映射，所以它们是完美的表示对象的数据类型

#### 有序集合 (Sorted sets)

Redis有序集合和Redis集合类似，是不包含 相同字符串的合集。Redis有序集合和Redis集合类似，是不包含 相同字符串的合集

+ O(log(N))时间复杂度完成添加删除和更新元素的操作

### Redis 持久化

Redis 提供了多种不同级别的持久化方式：

+ RDB 持久化可以在指定的时间间隔内生成数据集的时间点快照
+ AOF 持久化记录服务器执行的所有写操作命令，并在服务器启动时，重新执行这些命令来还原数据集。 AOF 文件中的命令全部以 Redis 协议的格式来保存，新命令会被追加到文件的末尾
+ Redis 还可以同时使用 AOF 和 RDB。在这种情况下，当Redis重启时，它会优先使用AOF文件来还原数据集，因为 AOF 文件保存的数据集通常比 RDB 文件所保存的数据集更完整。
+ 可以关闭持久化功能

#### RDB工作方式

当 Redis 需要保存 dump.rdb 文件时， 服务器执行以下操作:

+ Redis 调用forks. 同时拥有父进程和子进程
+ 子进程将数据集写入到一个临时 RDB 文件中
+ 当子进程完成对新 RDB 文件的写入时，Redis 用新 RDB 文件替换原来的 RDB 文件，并删除旧的 RDB 文件

#### RDB优点

+ RDB是一个非常紧凑的文件，它保存了某个时间点的数据集（快照），非常适用于数据集的备份和灾难恢复
+ RDB在保存RDB文件时父进程只需要fork出一个子进程，接下来写文件的工作全部由子进程来完成，父进程不需要再做其他IO操作，可以响应客户端的请求，所以RDB持久化方式可以最大化redis的性能。
+ 与AOF相比，在恢复大的数据集时，RDB方式会更快一些

#### RDB缺点

+ 相比AOF，数据不耐久
+ 在数据集非常庞大时，RDB以fork子进程方式会非常耗时

#### AOF工作方式

每当 Redis 执行一个改变数据集的命令时（比如 SET）， 这个命令就会被追加到 AOF 文件的末尾。

#### AOF优点

+ 更耐久，可以使用不同的fsync策略，使用每秒fsync策略时，出现故障时最多丢失1秒的数据
+ AOF持久化完成的是对指令集的增加操作，相对于RDB的每次都拷贝整个数据集更加省时安全
+ AOF可以在文件体积过大时，在后台完成重写，并且这种重写由于AOF重写缓冲区的存在是安全的
+ AOF 文件有序地保存了对数据库执行的所有写入操作， 这些写入操作以 Redis 协议的格式保存， 因此 AOF 文件的内容非常容易被人读懂， 对文件进行分析（parse）也很轻松

#### AOF缺点

+ 对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积
+ 根据所使用的 fsync 策略，AOF 的速度可能会慢于 RDB